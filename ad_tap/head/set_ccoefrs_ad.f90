!        Generated by TAPENADE     (INRIA, Ecuador team)
!  tapenade 3.x
!
!  Differentiation of set_ccoefrs in reverse (adjoint) mode (with options noISIZE i8):
!   gradient     of useful results: *d *e *f *concold *g *w *x
!                *propunit *a *b *c
!   with respect to varying inputs: *d *e *f *concold *g *w *x
!                *propunit *a *b *c
!   Plus diff mem management of: d:in e:in f:in concold:in g:in
!                w:in x:in propunit:in simtime:in a:in b:in c:in
!>    @brief coefficents for the transport equation (here only the right side)
!>    @param[in] spec species index
!>    @param[in] ismpl local sample index
!>    @details
!> calculate coefficents for the transport equation\n
!> coefficients are stored as vectors in the diagonals a-g (d center) and rhs in w.\n
SUBROUTINE SET_CCOEFRS_AD(spec, ismpl)
  use arrays

  USE ARRAYS_AD

  USE MOD_GENRL
  USE MOD_GENRLC
  USE MOD_CONC
  use mod_time

  USE MOD_TIME_AD

  USE MOD_LINFOS
  IMPLICIT NONE
  INTEGER :: ismpl
  INTEGER :: i, j, k
! DOUBLE PRECISION rhoceff
  DOUBLE PRECISION :: deltt
! INTEGER c1, c2, c3, c4
  INTEGER :: spec
  EXTERNAL DELTAT, POR
  EXTERNAL POR_AD0
  DOUBLE PRECISION :: DELTAT, POR
  DOUBLE PRECISION :: result1
  DOUBLE PRECISION :: result1_ad
  deltt = DELTAT(simtime(ismpl), ismpl)
! - - rhs: sources, also terms for transient calculations - - - - - - - - -
  IF (transient .AND. tr_switch(ismpl)) THEN
    DO k=1,k0
      DO j=1,j0
        DO i=1,i0
          CALL PUSHREAL8(result1)
          result1 = POR(i, j, k, ismpl)
        END DO
      END DO
    END DO
    DO k=k0,1,-1
      DO j=j0,1,-1
        DO i=i0,1,-1
          w_ad(i, j, k, ismpl) = w_ad(i, j, k, ismpl)/thetac
          concold_ad(i+(j-1)*i0+(k-1)*i0*j0, spec, cgen_time, ismpl) = &
&           concold_ad(i+(j-1)*i0+(k-1)*i0*j0, spec, cgen_time, ismpl) -&
&           result1*w_ad(i, j, k, ismpl)/deltt
          result1_ad = -(concold(i+(j-1)*i0+(k-1)*i0*j0, spec, cgen_time&
&           , ismpl)*w_ad(i, j, k, ismpl)/deltt)
          x_ad(i, j, k, ismpl) = x_ad(i, j, k, ismpl) - (1.d0-thetac)*&
&           w_ad(i, j, k, ismpl)
          CALL POPREAL8(result1)
          CALL POR_AD0(i, j, k, ismpl, result1_ad)
          result1_ad = -(d_ad(i, j, k, ismpl)/(deltt*thetac))
          CALL POR_AD0(i, j, k, ismpl, result1_ad)
        END DO
      END DO
    END DO
    CALL OMP_MVP_AD(i0, j0, k0, concold(1, spec, cgen_time, ismpl), &
&             concold_ad(1, spec, cgen_time, ismpl), x(1, 1, 1, ismpl), &
&             x_ad(1, 1, 1, ismpl), a(1, 1, 1, ismpl), a_ad(1, 1, 1, &
&             ismpl), b(1, 1, 1, ismpl), b_ad(1, 1, 1, ismpl), c(1, 1, 1&
&             , ismpl), c_ad(1, 1, 1, ismpl), d(1, 1, 1, ismpl), d_ad(1&
&             , 1, 1, ismpl), e(1, 1, 1, ismpl), e_ad(1, 1, 1, ismpl), f&
&             (1, 1, 1, ismpl), f_ad(1, 1, 1, ismpl), g(1, 1, 1, ismpl)&
&             , g_ad(1, 1, 1, ismpl))
  END IF
END SUBROUTINE SET_CCOEFRS_AD

